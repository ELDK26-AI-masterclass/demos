# AGENTS

> This file is automatically generated by Dev CLI. Do not edit manually.

## Available Agents

### threadly-dev
> [!TIP] Use this specialized agent by selecting it in Copilot (defined in `.github/agents/`)

## Files matching `src/features/ai/**/*`

<!-- Source: .dev/primitives/instructions/threadly-ai.instructions.md -->
# Threadly – AI Feature Instructions

These rules **supplement** the core `threadly.instructions.md` and are scoped to
`src/features/ai/`. They activate whenever the agent is editing, reviewing, or
generating code inside AI features.

## Azure OpenAI client

- Always import the shared client: `import { openai } from '@/lib/azure-openai'`
- Never instantiate `new OpenAI(...)` directly in feature code.
- Model to use: `gpt-4o` (deployment name `threadly-gpt4o`).
- Pass `{ stream: false }` unless a streaming UX has been explicitly designed.

## Prompt design

- System prompts live in `src/features/ai/prompts/` as `.ts` files exporting a `buildPrompt(params)` function.
- Keep system prompts **short and opinionated** — Threadly's tone is friendly, helpful, and never salesy.
- Always include a `maxTokens` guard: product descriptions ≤ 120 tokens; size recommendations ≤ 60 tokens.

## Graceful degradation (required on every AI feature)

Every AI-powered component **must** handle three states:

1. `idle` — show static/fallback content
2. `loading` — show a skeleton or spinner using `<AiLoadingIndicator />`
3. `error` — show a non-scary fallback message, never expose raw API errors to users

## Testing AI features

- Unit-test the `buildPrompt` helper — assert it returns correct token structure.
- Mock `src/lib/azure-openai.ts` in all component tests; never call real endpoints in CI.
- Add a `data-testid="ai-output"` attribute to the element that renders AI-generated content.

## When loading domain context

Before generating or refactoring AI feature code, load the **`threadly-products`** skill
to understand what product data looks like, and the **`threadly-faq`** skill if the
feature touches the support chat.
<!-- End source: .dev/primitives/instructions/threadly-ai.instructions.md -->

